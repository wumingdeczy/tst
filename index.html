<!DOCTYPE html>
<html>
<body>
  <textarea id="content" rows="10" cols="50" placeholder="输入要保存的内容..."></textarea><br>
  <button onclick="saveText()">发送</button>
  <div id="status"></div>

  <script>
    // 配置信息 - 请替换为你的GitHub信息
    const config = {
      owner: "wumingdeczy",
      repo: "tst",
      path: "saved.txt", // 要保存的文件名
      token: "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" // 需要有repo权限
    };

    async function saveText() {
      const content = document.getElementById('content').value;
      const status = document.getElementById('status');
      
      if (!content.trim()) {
        status.textContent = "请输入内容";
        return;
      }

      try {
        // 先获取现有文件信息（主要是sha值）
        const response = await fetch(
          `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`,
          { headers: { Authorization: `token ${config.token}` } }
        );

        let sha = null;
        if (response.ok) {
          const data = await response.json();
          sha = data.sha; // 现有文件的sha值，用于更新
        }

        // 保存内容
        const saveResponse = await fetch(
          `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${config.token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: 'Update saved text',
              content: btoa(unescape(encodeURIComponent(content))), // 转换为base64
              sha: sha // 如果是更新，需要提供sha
            })
          }
        );

        if (saveResponse.ok) {
          status.textContent = "内容已保存";
        } else {
          status.textContent = "保存失败";
        }
      } catch (error) {
        status.textContent = "发生错误: " + error.message;
      }
    }
  </script>
</body>
</html>
